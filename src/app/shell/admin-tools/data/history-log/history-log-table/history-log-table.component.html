<div class="wrapper">
  <div [hidden]="!dataSource" class="table-container mat-elevation-z8">
    <table mat-table [dataSource]="dataSource" matSort appStretchTable>
      <!-- Name Column -->
      <ng-container matColumnDef="pib">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'FORMS.LABELS.USER_THAT_CHANGE' | translate }}</th>
        <td mat-cell *matCellDef="let element">
          {{ getFullName(element?.user) }}
        </td>
      </ng-container>

      <ng-container matColumnDef="email">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'FORMS.LABELS.EMAIL' | translate }}</th>
        <td mat-cell *matCellDef="let element">{{ element.user?.email }}</td>
      </ng-container>

      <ng-container matColumnDef="providerTitle">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'FORMS.LABELS.PROVIDER_TITLE' | translate }}</th>
        <td mat-cell *matCellDef="let element">{{ element?.providerTitle | emptyValueTransform | translate}}</td>
      </ng-container>

      <ng-container matColumnDef="workshopTitle">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'FORMS.LABELS.WORKSHOP_TITLE' | translate }}</th>
        <td mat-cell *matCellDef="let element">{{ element?.workshopTitle | emptyValueTransform | translate}}</td>
      </ng-container>

      <ng-container matColumnDef="institutionTitle">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'FORMS.LABELS.SUBORDINATION' | translate }}</th>
        <td mat-cell *matCellDef="let element">
          {{ element?.institutionTitle | emptyValueTransform | translate}}
        </td>
      </ng-container>

      <ng-container matColumnDef="providerCity">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'FORMS.LABELS.SETTLEMENT' | translate }}</th>
        <td mat-cell *matCellDef="let element">
          <ng-container *ngIf="element.hasOwnProperty('providerCity')">
            {{ element.providerCity | emptyValueTransform | translate}}
          </ng-container>
          <ng-container *ngIf="element.hasOwnProperty('workshopCity')">
            {{ element.workshopCity | emptyValueTransform | translate}}
          </ng-container>
        </td>
      </ng-container>
      <ng-container matColumnDef="fieldName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'FORMS.LABELS.TYPE' | translate }}</th>
        <td mat-cell *matCellDef="let element">
          <ng-container *ngIf="element.hasOwnProperty('fieldName')">
            {{ typeChange[element?.fieldName] | emptyValueTransform | translate}}
          </ng-container>
          <ng-container *ngIf="element.hasOwnProperty('operationType')">
            {{ adminStatus[element?.operationType] | emptyValueTransform | translate}}
          </ng-container>
        </td>
      </ng-container>

      <ng-container matColumnDef="updatedDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'FORMS.LABELS.DATE_TIME' | translate }}</th>
        <td mat-cell *matCellDef="let element">
          <ng-container *ngIf="element.hasOwnProperty('updatedDate')">
            {{ element.updatedDate | date : SHORT_DATE_FORMAT | emptyValueTransform | translate}}
          </ng-container>
          <ng-container *ngIf="element.hasOwnProperty('operationDate')">
            {{ element.operationDate | date : FULL_DATE_FORMAT_ONLY_DIGITS | emptyValueTransform | translate}}
          </ng-container>
        </td>
      </ng-container>

      <ng-container matColumnDef="oldValue">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'HISTORY_LOG.WAS' | translate }}</th>
        <td
          mat-cell
          *matCellDef="let element"
          [ngClass]="{ 'application-status': isApplicationHistoryType }"
          class="{{ element.oldValue }}">
          {{
            (isApplicationHistoryType ? statusTitles[element?.oldValue] : element?.oldValue)
              | emptyValueTransform : DASH_VALUE | translate
          }}
        </td>
      </ng-container>

      <ng-container matColumnDef="newValue">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>{{ 'HISTORY_LOG.BECAME' | translate }}</th>
        <td
          mat-cell
          *matCellDef="let element"
          [ngClass]="{ 'application-status': isApplicationHistoryType }"
          class="{{ element.newValue }}">
          {{
            (isApplicationHistoryType ? statusTitles[element?.newValue] : element?.newValue) 
              | emptyValueTransform : DASH_VALUE | translate
          }}
        </td>
      </ng-container>

      <ng-container *ngIf="tableType === HistoryLogTypes.ProviderAdmins; else tableWithoutAdditionalProviderAdminsColumn">
        <tr mat-header-row *matHeaderRowDef="displayedProviderAdminsColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedProviderAdminsColumns"></tr>
      </ng-container>
      <ng-template #tableWithoutAdditionalProviderAdminsColumn>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </ng-template>
    </table>
  </div>
</div>
