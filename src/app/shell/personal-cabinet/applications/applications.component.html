<div class="container" *ngIf="(applications$ | async)?.length then isApplications; else isEmptyList"></div>

<ng-template #isApplications>
  <div class="container" *ngIf="(userRole === role.provider) then isProvider; else isParent"></div>
</ng-template>

<ng-template #isProvider>
  <app-workshop-checkbox-dropdown fxLayout='row' fxLayoutAlign='end' [workshops]="workshops$ | async"
    (workshopCheck)="workshopList = $event">
  </app-workshop-checkbox-dropdown>
  <div class="tab-wrapper">
    <mat-tab-group mat-align-tabs="start" (selectedTabChange)="onChangeTab($event)">
      <mat-tab label="Усі">
        <ng-container
          *ngTemplateOutlet="Applications; context:{$implicit: applications$ | async | applicationSort : applicationStatus.pending : 'date' | workshopFilter: workshopList }">
        </ng-container>
      </mat-tab>
      <mat-tab label="{{applicationStatusUkr[applicationStatus.pending]}}" (click)="onStatusChange(applicationStatus.pending)">
        <ng-container
          *ngTemplateOutlet="Applications; context:{$implicit: applications$  | workshopFilter: workshopList}" [status]="0">
        </ng-container>
      </mat-tab>
      <mat-tab label="{{applicationStatusUkr[applicationStatus.acceptedForSelection]}}" (click)="onStatusChange(applicationStatus.acceptedForSelection)">
        <ng-container
          *ngTemplateOutlet="Applications; context:{$implicit: applications$ | async | applicationFilter : applicationStatus.acceptedForSelection | workshopFilter: workshopList }"  [status]="1">
        </ng-container>
      </mat-tab>
      <mat-tab label="{{applicationStatusUkr[applicationStatus.approved]}}" [status]="applicationStatus.approved">
        <ng-container
          *ngTemplateOutlet="Applications; context:{$implicit: applicationsByStatus$ | async  | workshopFilter: workshopList }" >
        </ng-container>
      </mat-tab>
      <mat-tab label="{{applicationStatusUkr[applicationStatus.rejected]}}"  [status]="applicationStatus.rejected">
        <ng-container
          *ngTemplateOutlet="Applications; context:{$implicit: applicationsByStatus$ | async  | workshopFilter: workshopList }"  >
        </ng-container>
      </mat-tab>
      <mat-tab label="{{applicationStatusUkr[applicationStatus.left]}}"  [status]="applicationStatus.left">
        <ng-container
          *ngTemplateOutlet="Applications; context:{$implicit: applicationsByStatus$ | async  | workshopFilter: workshopList }"  >
        </ng-container>
      </mat-tab>
    </mat-tab-group>
  </div>

</ng-template>

<ng-template #isEmptyList>
  <p class="no-application-wrapper">Заявок поки немає</p>
</ng-template>

<ng-template #isParent>
  <div *ngIf="(children$| async)">
    <div *ngFor="let child of (children$| async)">

      <div *ngIf="(applications$ | async | applicationChildFilter : child)?.length then ChildApplication"></div>

      <ng-template #ChildApplication>
        <h3> {{ child.firstName }} {{ child.lastName }} {{ child.middleName }}</h3>
        <ng-container
          *ngTemplateOutlet="Applications; context:{$implicit: applications$ | async | applicationChildFilter : child }">
        </ng-container>
      </ng-template>

    </div>
  </div>

</ng-template>

<ng-template #Applications let-applications>
  <div class="container" *ngIf="applications.length then ApplicationList; else isEmptyList"></div>
  <ng-template #ApplicationList>
    <app-application-card *ngFor="let application of applications" [application]="application" [userRole]="userRole"
      (approved)="onApprove($event)" (rejected)="onReject($event)" (infoShow)="onInfoShow($event)"
      (infoHide)="onInfoHide()">
    </app-application-card>
  </ng-template>
</ng-template>


<ng-template appInfoBoxHost></ng-template>