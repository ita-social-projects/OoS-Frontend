<div class="container" *ngIf="(role === Role.provider) then isProvider; else isParent"></div>


<ng-template #isProvider>
  <div class="dropdown">
    <i class="material-icons status-info-icon" [matMenuTriggerFor]="menu" #trigger="matMenuTrigger"
      [ngClass]="trigger.menuOpen ? 'activeInfoBtn' : 'inactiveInfoBtn'">info_outline</i>
    <mat-menu [hasBackdrop]="true" disabled #menu="matMenu" [overlapTrigger]="false" class="mat-application-menu">
      <app-status-info-card></app-status-info-card>
    </mat-menu>

    <app-entity-checkbox-dropdown [entities]="workshops$ | async" [declination]="WorkshopDeclination" (entityCheck)="onEntitiesSelect($event)">
    </app-entity-checkbox-dropdown>
  </div>

  <div class="tab-wrapper">
    <mat-tab-group mat-align-tabs="start" (selectedTabChange)="onTabChange($event)" [selectedIndex]="tabIndex">
      <mat-tab label="{{applicationTitles.All}}">
        <ng-container *ngTemplateOutlet="ProviderApplication; context:{$implicit: applications$ | async }">
        </ng-container>
      </mat-tab>
      <mat-tab label="{{applicationTitles.Pending}}">
        <ng-container *ngTemplateOutlet="ProviderApplication; context:{$implicit: applications$| async }">
        </ng-container>
      </mat-tab>
      <!-- <mat-tab label="{{applicationTitles[applicationStatus.AcceptedForSelection]}}">
        <ng-container *ngTemplateOutlet="ProviderApplication; context:{$implicit: applications$| async }">
        </ng-container>
      </mat-tab> TODO: display when functionality is ready -->
      <mat-tab label="{{applicationTitles.Approved}}">
        <ng-container *ngTemplateOutlet="ProviderApplication; context:{$implicit: applications$ | async }">
        </ng-container>
      </mat-tab>
      <mat-tab label="{{applicationTitles.Rejected}}">
        <ng-container *ngTemplateOutlet="ProviderApplication; context:{$implicit: applications$ | async }">
        </ng-container>
      </mat-tab>
      <mat-tab label="{{applicationTitles.Left}}">
        <ng-container *ngTemplateOutlet="ProviderApplication; context:{$implicit: applications$ | async }">
        </ng-container>
      </mat-tab>
    </mat-tab-group>
  </div>
</ng-template>

<ng-template #isEmptyList>
  <app-no-result-card [title]="noApplicationTitle"></app-no-result-card>
</ng-template>

<ng-template #isParent>
    <div class="dropdown">
      <i class="material-icons status-info-icon" [matMenuTriggerFor]="menu" #trigger="matMenuTrigger"
        (click)=" isActiveInfoButton=!isActiveInfoButton"
        [ngClass]="isActiveInfoButton ? 'activeInfoBtn' : 'inactiveInfoBtn'">info_outline</i>
      <mat-menu [hasBackdrop]=" false" disabled #menu="matMenu" [overlapTrigger]="false" class="mat-application-menu">
        <app-status-info-card></app-status-info-card>
      </mat-menu>

      <app-entity-checkbox-dropdown [entities]="childrenCards" [declination]="ChildDeclination" (entityCheck)="onEntitiesSelect($event)">
      </app-entity-checkbox-dropdown>

    </div>

    <div class="tab-wrapper">
      <mat-tab-group mat-align-tabs="start" (selectedTabChange)="onTabChange($event)">
        <mat-tab label="Усі">
          <ng-container *ngTemplateOutlet="ParentApplication; context:{$implicit: applications$ | async }">
          </ng-container>
        </mat-tab>
        <mat-tab label="{{applicationTitles[applicationStatus.Pending]}}">
          <ng-container *ngTemplateOutlet="ParentApplication; context:{$implicit: applications$ | async }">
          </ng-container>
        </mat-tab>
        <!-- <mat-tab label="{{applicationTitles[applicationStatus.AcceptedForSelection]}}">
          <ng-container *ngTemplateOutlet="ProviderApplication; context:{$implicit: applications$| async }">
          </ng-container>
        </mat-tab> TODO: display when functionality is ready -->
        <mat-tab label="{{applicationTitles[applicationStatus.Approved]}}">
          <ng-container *ngTemplateOutlet="ParentApplication; context:{$implicit: applications$ | async }">
          </ng-container>
        </mat-tab>
        <mat-tab label="{{applicationTitles[applicationStatus.Rejected]}}">
          <ng-container *ngTemplateOutlet="ParentApplication; context:{$implicit: applications$ | async }">
          </ng-container>
        </mat-tab>
        <mat-tab label="{{applicationTitles[applicationStatus.Left]}}">
          <ng-container *ngTemplateOutlet="ParentApplication; context:{$implicit: applications$ | async }">
          </ng-container>
        </mat-tab>
      </mat-tab-group>
    </div>

</ng-template>

<ng-template #Applications let-applications>
  <app-application-card *ngFor="let application of applications" [application]="application" [userRole]="role"
    (approved)="onApprove($event)" (rejected)="onReject($event)" (leave)="onLeave($event)"
    (infoShow)="onInfoShow($event)" (infoHide)="onInfoHide()">
  </app-application-card>
</ng-template>

<ng-template #ProviderApplication let-applications>
  <ng-container *ngIf="!(isLoadingCabinet$ | async)">
    <ng-container *ngIf="applications?.length else isEmptyList;">
      <ng-container *ngTemplateOutlet="Applications; context:{$implicit: applications}">
      </ng-container>
    </ng-container>
  </ng-container>
</ng-template>

<ng-template #ParentApplication let-applications>
  <ng-container *ngIf="!(isLoadingCabinet$ | async)">
    <ng-container *ngIf="applications?.length else isEmptyList;">

      <div *ngIf="filteredChildren.length && (applications$ | async)?.length; else isEmptyList">
        <div *ngFor="let child of filteredChildren | applicationChildSorting : applications">
          <ng-container *ngTemplateOutlet="ChildApplication; context:{$implicit: applications$ | async | applicationChildFilter : child, child: child }">
          </ng-container>
        </div>
      </div>

    </ng-container>
  </ng-container>
</ng-template>

<ng-template #ChildApplication let-childApplications let-child="child">
  <ng-container *ngIf="isSelectedChildCheckbox || !isSelectedChildCheckbox && childApplications.length">
    <h3 class="child-name">{{ child.lastName }} {{ child.firstName }}  {{ child.middleName }} ({{ child.dateOfBirth | date: constants.SHORT_DATE_FORMAT }})</h3>
    <ng-container *ngIf="childApplications.length; else isEmptyList">
      <ng-container
        *ngTemplateOutlet="Applications; context:{$implicit: childApplications }">
      </ng-container>
    </ng-container>
  </ng-container>
</ng-template>

<ng-template appInfoBoxHost></ng-template>
