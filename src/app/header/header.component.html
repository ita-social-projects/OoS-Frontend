<div class="header" [ngClass]="isRouter('/') ? '' : 'header_secondary'">
  <div [ngClass]="{ 'hide-content header_secondary': (isAutorizationLoading$ | async) }">
    <div class="header_top">
      <div class="header_logo-wrapper">
        <div *ngIf="(isMobileScreen$ | async) && navigationPaths?.length > 0; then mobileNav; else logo"></div>
        <ng-template #mobileNav>
          <app-navigation-mobile-bar></app-navigation-mobile-bar>
        </ng-template>
        <ng-template #logo>
          <a routerLink="/"><img class="logo" src="../../assets/images/Logo.svg" alt="Позашкілля" /></a>
        </ng-template>
      </div>

      <div class="header_btns">
        <div class="header-info-link">
          <a [routerLink]="'./info/about'"> {{ 'header.top.about' | translate }}</a>
        </div>
        <div class="header-info-link">
          <a [routerLink]="'./info/rules'">{{ 'header.top.rules' | translate }}</a>
        </div>
        <div class="header-info-link">
          <a [routerLink]="'./info/support'">{{ 'header.top.support' | translate }}</a>
        </div>

        <button mat-flat-button class="header_lang">
          <mat-icon>language</mat-icon>
          <mat-select
            (selectionChange)="setLanguage()"
            [(value)]="selectedLanguage"
            class="lang-option"
            disableOptionCentering
            panelClass="dropdown-panel">
            <mat-option class="lang-option-text" value="uk"> {{ Languages.uk }} </mat-option>
            <mat-option class="lang-option-text" value="en"> {{ Languages.en }} </mat-option>
          </mat-select>
        </button>

        <ng-conatiner *ngIf="(isAuthorized$ | async) && user; then isAuthorized; else isUnauthorized"></ng-conatiner>
      </div>
    </div>

    <div *ngIf="isRouter('/'); then isMainPage" class="header_wrapper"></div>
  </div>
</div>
<app-progress-bar></app-progress-bar>

<ng-template #isMainPage>
  <div fxLayout="column" fxLayoutAlign="none center">
    <h1 class="header_title">{{ headerTitle }}</h1>
    <h2 class="header_descr">{{ headerSubtitle }}</h2>
    <div class="header-full-search-bar-wrap">
      <app-full-search-bar></app-full-search-bar>
    </div>
  </div>
</ng-template>

<ng-template #isUnauthorized>
  <button mat-flat-button class="header_menu-button-mobile" (click)="changeView()">
    <mat-icon>menu</mat-icon>
  </button>
  <button mat-stroked-button class="header_login" (click)="login()">{{ 'header.top.login' | translate }}</button>
</ng-template>

<ng-template #isAuthorized>
  <div class="authorization">
    <app-notifications *ngIf="(featuresList$ | async).release2"></app-notifications>

    <button mat-flat-button class="user-name" [matMenuTriggerFor]="log">
      <mat-icon>account_circle</mat-icon>
      {{ userShortName }}
      <mat-icon>arrow_drop_down</mat-icon>
    </button>

    <button mat-flat-button class="header_menu-button-mobile" (click)="changeView()">
      <mat-icon>menu</mat-icon>
    </button>

    <mat-menu #log="matMenu" class="header_menu">
      <button mat-menu-item class="header_menu_account-button">
        <ng-container>{{ userShortName }}</ng-container>
        <button
          mat-raised-button
          class="header_menu_account-button_account-circle"
          matBadge="2"
          matBadgePosition="before"
          matBadgeColor="accent">
          <i>
            <mat-icon class="icon-account">account_circle</mat-icon>
          </i>
        </button>
      </button>
      <div
        *ngIf="user?.role !== Role.techAdmin && user?.role !== Role.ministryAdmin; then UserView; else AdminView"></div>
      <ng-template #UserView>
        <ng-container *ngIf="isRegistered$ | async">
          <a [routerLink]="'./personal-cabinet/config'"
            ><button mat-menu-item>{{ 'header.authorization.info-personal' | translate }}</button></a
          >
          <a [routerLink]="'./personal-cabinet/' + user.role + '/info'">
            <button mat-menu-item>
              {{ 'header.authorization.info-about' | translate }}
              {{ roles[user.role] | translate }}
            </button>
          </a>
          <a *ngIf="user.role === Role.provider" [routerLink]="'./personal-cabinet/' + user.role + '/workshops'">
            <button mat-menu-item>
              {{ 'header.authorization.my-workshops' | translate }}
            </button>
          </a>
          <a [routerLink]="'./personal-cabinet/' + user.role + '/applications'">
            <button mat-menu-item>
              {{ 'header.authorization.my-statements' | translate }}
            </button>
          </a>
          <a
            *ngIf="user.role === Role.provider && subrole !== Role.ProviderAdmin"
            [routerLink]="'./personal-cabinet/provider/administration'">
            <button mat-menu-item>
              {{ 'header.authorization.administration' | translate }}
            </button>
          </a>
          <a *ngIf="user.role === Role.parent" [routerLink]="'./personal-cabinet/parent/favorite'">
            <button mat-menu-item>
              {{ 'header.authorization.favorite' | translate }}
            </button>
          </a>
        </ng-container>
        <button mat-menu-item class="logout-btn" (click)="logout()">
          {{ 'header.authorization.logout' | translate }}
        </button>
      </ng-template>
      <ng-template #AdminView>
        <a [routerLink]="'./personal-cabinet/config'"
          ><button mat-menu-item>
            {{ 'header.authorization.info-personal' | translate }}
          </button></a
        >
        <a
          *ngIf="user.role === Role.techAdmin"
          [routerLink]="'./admin-tools/platform'"
          [queryParams]="{ page: defaultAdminTabs }">
          <button mat-menu-item>
            {{ 'header.authorization.administration' | translate }}
          </button></a
        >
        <a *ngIf="user.role === Role.ministryAdmin" [routerLink]="'./admin-tools/data/admins'">
          <button mat-menu-item>
            {{ 'header.authorization.administration' | translate }}
          </button></a
        >
        <button mat-menu-item (click)="logout()">
          {{ 'header.authorization.logout' | translate }}
        </button>
      </ng-template>
    </mat-menu>
  </div>
</ng-template>
