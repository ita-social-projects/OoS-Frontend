<mat-card class="position">
  <div *ngIf="(isMainPage || userRole !== role.provider) then UserActions; else ProviderActions;">
  </div>
  <div class="card" fxLayout="column" fxLayoutAlign="space-between space-between">
    <img mat-card-image src="assets/icons/workshop.png" alt="workshop-photo">
    <mat-card-header>
      <mat-card-title [matTooltip]="workshop.title" showTooltipIfTruncated [matTooltipPosition]="below">
        {{workshop.title}}</mat-card-title>
      <img class="card_category" src="assets/icons/lang.png" alt="workshop-category">
    </mat-card-header>
    <div *ngIf="isMainPage then MainView; else UserView"></div>
    <mat-card-footer fxLayout="row" fxLayoutAlign="end">
    <div>
      <a [routerLink]="['/workshop-details',workshop.workshopId ]" class="card_link">
        Детальніше
        <span class="material-icons arrow">arrow_forward</span>
      </a>
    </div>

    </mat-card-footer>
  </div>
</mat-card>

<ng-template #MainView>
  <mat-card-content fxLayout="column" fxLayoutAlign="space-between">
    <p class="card_text">
      <mat-icon class="card_icon">star</mat-icon> {{ workshop.rating }}
    </p>
    <p class="card_text">
      <mat-icon class="card_icon">home</mat-icon>{{ workshop.providerTitle }}
    </p>
    <p class="card_text">
      <mat-icon class="card_icon">person</mat-icon>{{ workshop.minAge }} - {{ workshop.maxAge }} років
    </p>
    <p class="card_text" *ngIf="!workshop.price">
      <mat-icon class="card_icon"> attach_money</mat-icon> Безкоштовно
    </p>
    <p class="card_text" *ngIf="workshop.price">
      <mat-icon class="card_icon"> attach_money</mat-icon> {{ workshop.price }} грн/
      {{ workshop.isPerMonth
      ? 'місяць' : 'заняття' }}
    </p>
    <p class="card_text" *ngIf="workshop.address">
      <mat-icon class="card_icon"> place</mat-icon> {{ workshop.address.city }}, {{
      workshop.address.street }}, {{
      workshop.address.buildingNumber }}
    </p>
  </mat-card-content>
</ng-template>

<ng-template #UserView>
  <mat-card-content class="user" fxLayout="column" fxLayoutAlign="space-between">
    <div *ngIf="userRole === role.provider then ProviderChangeStatus; else ParentChangeStatus"></div>
    <p class="card_text">
      <mat-icon class="card_icon" class="card_icon">person</mat-icon>
      {{ userRole !== role.provider ? "Всього учасників" : "Доступних місць" }}
    </p>
    <p class="card_text">
      <mat-icon class="card_icon">access_time</mat-icon> Очікує підтвердження
    </p>
    <p class="card_text">
      <mat-icon class="card_icon"> email</mat-icon> Повідомлення
    </p>
  </mat-card-content>
</ng-template>

<ng-template #ProviderActions>
  <div fxLayout="row" fxLayoutAlign="end start" class="actions">
    <div class="actions_btn action-icon" [routerLink]="['/create-workshop', workshop.id]">
      <mat-icon>edit</mat-icon>
    </div>
    <div class="actions_btn action-icon" (click)="onDelete()">
      <mat-icon>delete</mat-icon>
    </div>
  </div>
</ng-template>

<ng-template #UserActions>
  <div fxLayout="row" fxLayoutAlign="end start" class="actions">

    <ng-container *ngIf="isFavorite then favorite; else notFavorite"></ng-container>
    <ng-template #favorite>
      <div (click)="parent && onDisLike(this.favoriteWorkshopId?.id)" class="actions_btn action-icon favorite-icon">
        <mat-icon>favorite</mat-icon>
      </div>
    </ng-template>

    <ng-template #notFavorite>
      <div (click)="parent && onLike()" class="actions_btn action-icon">
        <mat-icon>favorite_border</mat-icon>
      </div>
    </ng-template> 
  </div>
</ng-template>

<ng-template #ProviderChangeStatus>
  <div fxLayout="row" fxLayoutAlign="space-between center">
    <mat-chip class="status chip_{{status}}" fxLayout="row" fxLayoutAlign="center center">
      <p class="status_text">{{ status === 'approved'
        ? "Набір відкрито" : "Набір завершено" }}</p>
    </mat-chip>
    <p class="card_link status_action" *ngIf="status === 'approved'"> Призупинити
      набір </p>
  </div>
</ng-template>

<ng-template #ParentChangeStatus>
  <div fxLayout="row" fxLayoutAlign="space-between center" class="parent-status">
    <p class="{{applicationStatus[application.status]}} icon">
      <mat-icon>how_to_reg</mat-icon>{{
      applicationStatusUkr[application.status] }}
    </p>
    <p class="card_link status_action" *ngIf="applicationStatus[application.status] === applicationStatus.approved"
      (click)="onWorkshopLeave()">Залишити гурток
    </p>
  </div>
</ng-template>