<div class="notifications-list" (click)="stopPropagation($event)">
  <ng-container *ngIf="notificationsData$ | async as notificationsData">
    <div class="notifications-list__header">
      <h3 class="notifications-list__title">СПОВІЩЕННЯ</h3>
      <mat-icon class="icon" [matMenuTriggerFor]="actions">more_vert</mat-icon>
      <mat-menu #actions="matMenu" class="notifications-list-menu" xPosition="before">
        <button mat-menu-item (click)="onReadAll()">Позначити всі як прочитані</button>
        <button mat-menu-item>Видалити всі</button>
      </mat-menu>
    </div>

    <ng-container
      *ngIf="
        (notificationsData$ | async)?.notifications.length || (notificationsData$ | async)?.notificationsGrouped.length;
        else isEmptyList
      "
    >
      <ng-container *ngTemplateOutlet="Notifications; context: { $implicit: notificationsData }"> </ng-container>
    </ng-container>
  </ng-container>
</div>

<ng-template #isEmptyList>
  <span fxLayout="row wrap" fxLayoutAlign="start start">{{ NotificationsConstants.NO_MESSAGE }}</span>
</ng-template>

<ng-template #Notifications let-notificationsData>
  <div class="accordions-wrapper">
    <cdk-accordion *ngIf="notificationsData.notificationsGrouped.length">
      <cdk-accordion-item
        *ngFor="let groupByType of groupsByType"
        #accordionGroupItem="cdkAccordionItem"
        role="button"
        class="notification"
      >
        <div [class]="groupByType.isRead ? 'notification__wrapper' : 'notification__wrapper new'">
          <div class="header-notification header-notification__group-info" (click)="accordionGroupItem.toggle()">
            <div class="info">
              <span class="info__description">У вас {{ groupByType.amount | declination: ApplicationHeaderDeclinations }}</span>
            </div>
            <mat-icon [matMenuTriggerFor]="actions" class="icon" (click)="stopPropagation($event)">more_vert</mat-icon>
            <mat-menu #actions="matMenu" xPosition="before" class="notifications-list-menu">
              <button mat-menu-item (click)="onReadGroup(groupByType); stopPropagation($event)">Прочитати групу</button>
            </mat-menu>
          </div>
          <div
            [style.max-height]="accordionGroupItem.expanded ? '100px' : '0px'"
            [style.overflow]="accordionGroupItem.expanded ? 'auto' : 'hidden'"
            role="region"
            class="body-notification"
          >
            <div
              *ngFor="let group of notificationsData.notificationsGrouped"
              class="header-notification header-notification__group-details info"
              (click)="onGroupByStatusClick(group)"
            >
              <mat-icon class="icon">navigate_next</mat-icon>
              <span class="info__description">{{ group.amount | declination: defineDeclination(group.groupedData) }}</span>
            </div>
          </div>
        </div>
      </cdk-accordion-item>
    </cdk-accordion>
    <!-- TODO:  Finish notifications for single notifications (when they start coming from the database) -->
    <cdk-accordion *ngIf="notificationsData.notifications.length">
      <cdk-accordion-item
        *ngFor="let notification of notificationsData.notifications"
        #accordionItem="cdkAccordionItem"
        role="button"
        class="notification"
        [disabled]="notification.data ? 'false' : 'true'"
      >
        <div [class]="notification.readDateTime ? 'notification__wrapper' : 'notification__wrapper new'">
          <div class="header-notification" (click)="accordionItem.toggle()">
            <div class="header-notification__single-info info">
              <h4 class="info__workshop-name">Лего</h4>
              <span class="info__description">Ваша заявка була відхилена з вказаною причиною</span>
              <h4 class="info__time">{{ notification.createdDateTime | date: 'HH:mm' }}</h4>
            </div>
            <mat-icon [matMenuTriggerFor]="actions" class="icon" (click)="stopPropagation($event)">more_vert</mat-icon>
            <mat-menu #actions="matMenu" xPosition="before" class="notifications-list-menu">
              <button mat-menu-item (click)="onReadSingle(notification); stopPropagation($event)">Позначити як прочитане</button>
              <button mat-menu-item (click)="onDeleteSingle(notification); stopPropagation($event)">Видалити сповіщення</button>
            </mat-menu>
          </div>
          <div
            [style.max-height]="accordionItem.expanded ? '100px' : '0px'"
            [style.overflow]="accordionGroupItem.expanded ? 'auto' : 'hidden'"
            role="region"
            class="body-notification"
          >
            This is the primary content of the panel.
          </div>
        </div>
      </cdk-accordion-item>
    </cdk-accordion>
  </div>
</ng-template>
