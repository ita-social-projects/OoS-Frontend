<div class="notifications-list" (click)="onRead($event)">
  <ng-container *ngIf="notificationsData$ | async as notificationsData">
    <div class="notifications-list__header">
      <h3 class="notifications-list__title">СПОВІЩЕННЯ</h3>
      <mat-icon class="menu-icon" [matMenuTriggerFor]="actions">more_vert</mat-icon>
      <mat-menu #actions="matMenu" class="notifications-list-menu" xPosition="before">
        <button mat-menu-item (click)="onReadAll($event)">Позначити всі як прочитані</button>
        <button mat-menu-item>Видалити всі</button>
      </mat-menu>
    </div>

    <ng-container
      *ngIf="
        (notificationsData$ | async)?.notifications.length || (notificationsData$ | async)?.notificationsGrouped.length;
        else isEmptyList
      "
    >
      <ng-container *ngTemplateOutlet="Notifications; context: { $implicit: notificationsData }"> </ng-container>
    </ng-container>
  </ng-container>
</div>

<ng-template #isEmptyList>
  <span fxLayout="row wrap" fxLayoutAlign="start start">{{ notificationsConstants.NO_MESSAGE }}</span>
</ng-template>

<ng-template #Notifications let-notificationsData>
  <ng-container *ngIf="notificationsData.notificationsGrouped.length">
    <div class="accordions-wrapper">
      <cdk-accordion>
        <cdk-accordion-item
          *ngFor="let notificationGroupByType of notificationsGroupedByType"
          #accordionGroupItem="cdkAccordionItem"
          role="button"
          class="notification-item"
        >
          <div [class]="notificationGroupByType.isRead ? 'notification-item__wrapper' : 'notification-item__wrapper new'">
            <div class="item-header" (click)="accordionGroupItem.toggle()">
              <div class="item-header__info-block">
                <span class="item-header__description"
                  >У вас {{ notificationGroupByType.amount | declination: ApplicationHeaderDeclinations }}</span
                >
              </div>
              <mat-icon [matMenuTriggerFor]="actions" class="menu-icon" (click)="onRead($event)">more_vert</mat-icon>
              <mat-menu #actions="matMenu" xPosition="before" class="notifications-list-menu">
                <button mat-menu-item (click)="onReadGroup($event, notificationGroupByType)">Прочитати групу</button>
              </mat-menu>
            </div>
            <div [style.max-height]="accordionGroupItem.expanded ? '100px' : '0px'" role="region" class="item-body">
              <div *ngFor="let notificationGroup of notificationsData.notificationsGrouped" class="notification-item">
                <div class="group-items-wrapper">
                  <div class="item-header item-header__group-details">
                    <div class="item-header__info-block">
                      <span class="item-header__description">{{
                        notificationGroup.amount | declination: defineDeclination(notificationGroup.groupedData)
                      }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </cdk-accordion-item>
      </cdk-accordion>
    </div>
  </ng-container>
  <ng-container *ngIf="notificationsData.notifications.length">
    <div class="accordions-wrapper">
      <cdk-accordion>
        <cdk-accordion-item
          *ngFor="let notification of notificationsData.notifications"
          #accordionItem="cdkAccordionItem"
          role="button"
          class="notification-item"
          [disabled]="notification.data ? 'false' : 'true'"
        >
          <div [class]="notification.readDateTime ? 'notification-item__wrapper' : 'notification-item__wrapper new'">
            <div class="notification-item__header item-header" (click)="accordionItem.toggle()">
              <div class="item-header__info-block">
                <h4 class="item-header__workshop-name">Лего</h4>
                <span class="item-header__description">Ваша заявка була відхилена з вказаною причиною</span>
                <h4 class="item-header__time">{{ notification.createdDateTime | date: 'HH:mm' }}</h4>
              </div>
              <mat-icon [matMenuTriggerFor]="actions" class="menu-icon" (click)="onRead($event)">more_vert</mat-icon>
              <mat-menu #actions="matMenu" xPosition="before" class="notifications-list-menu">
                <button mat-menu-item (click)="onReadSingle($event, notification)">Позначити як прочитане</button>
                <button mat-menu-item (click)="onDeleteSingle($event, notification)">Видалити сповіщення</button>
              </mat-menu>
            </div>
            <div [style.max-height]="accordionItem.expanded ? '100px' : '0px'" role="region" class="item-body">
              This is the primary content of the panel.
            </div>
          </div>
        </cdk-accordion-item>
      </cdk-accordion>
    </div>
  </ng-container>
</ng-template>

<ng-template #Notfications let-notificationsData>
  <ng-container *ngIf="notificationsData.notificationsGrouped.length">
    <span *ngFor="let notifications of notificationsData.notificationsGrouped" fxLayout="row wrap" fxLayoutAlign="space-between center"
      >{{ notifications.amount | declination: defineDeclination(notifications.groupedData) }}
      <mat-icon class="icon" (click)="onReadGroup(notifications)"> arrow_forward</mat-icon>
    </span>
  </ng-container>
  <ng-container *ngIf="notificationsData.notifications.length">
    <div *ngFor="let notification of notificationsData.notifications" matMenuItem disableRipple="true">
      <span fxLayout="row" fxLayoutAlign="space-between center">
        <div *ngIf="notification.data.Title">
          Набір у гурток "{{ notification.data.Title }}"
          {{ notificationWorkshopStatusUkr[notification.data.Status] }}
        </div>
        <div *ngIf="notification.data.Status === statuses.Approved">
          {{ notificationText.Approved }}
        </div>
        <div class="editing" *ngIf="notification.data.Status === statuses.Editing">
          {{ notificationText.Editing }}
        </div>
        <div>
          <mat-icon class="icon" (click)="onReadSingle($event, notification)"> highlight_off </mat-icon>
        </div>
      </span>
    </div>
  </ng-container>
</ng-template>
